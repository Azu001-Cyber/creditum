
{% extends 'base.html' %}
{% load static %}

{%block title%} Loan Details {%endblock%}
{% block content %}
<div class="container mt-4">
    <div class="card shadow-sm">
        <div class="card-header bg-primary text-white">
            <h4 class="mb-0">Loan Details</h4>
        </div>

        <div class="card-body">

            <!-- Loan Summary -->
            <h5 class="mb-3 text-secondary">Loan Summary</h5>
            <div class="row mb-4">
                <div class="col-md-4">
                    <p><strong>Borrower:</strong> {{ loan.borrower.first_name }} {{loan.borrower.last_name}}</p>
                    <p><strong>Status:</strong> 
                        <span class="badge 
                            {% if loan.status.STATUS_APPROVED == 'STATUS_APPROVED' %} bg-success 
                            {% elif loan.status.STATUS_PENDING == 'STATUS_PENDING' %} bg-warning 
                            {% elif loan.status == 'Rejected' %} bg-danger 
                            {% else %} bg-secondary 
                            {% endif %}
                        ">
                            {{ loan.status }}
                        </span>
                    </p>
                </div>
                <div class="col-md-4">
                    <p><strong>Loan ID:</strong> {{ loan.id }}</p>
                    <p><strong>Date Requested:</strong> {{ loan.created_at }}</p>
                </div>
            </div>

            <hr>

            <!-- Loan Information -->
            <h5 class="mb-3 text-secondary">Loan Information</h5>
            <div class="row mb-4">
                <div class="col-md-4">
                    <p><strong>Loan Amount:</strong> ₦{{ loan.amount }}</p>
                    <p><strong>Interest Rate:</strong> {{ loan.interest_rate }}%</p>
                </div>
                <div class="col-md-4">
                    <p><strong>Tenure:</strong> {{ loan.tenure_months }} Months</p>
                    <p><strong>Total Payable:</strong> ₦{{ loan.total_payable }}</p>
                </div>
                <div class="col-md-4">
                    <p><strong>Monthly Payment:</strong> ₦{{ loan.monthly_installment }}</p>
                </div>
                <div class="col-md-4">
                    <p><strong>Remaining Balance</strong> ₦{{loan.remaining_balance}} </p>
                </div>
            </div>

            <hr>

            <!-- Bank Details -->
            <h5 class="mb-3 text-secondary">Bank Details</h5>
            <div class="row mb-4">
                <div class="col-md-4">
                    <p><strong>Bank Name:</strong> {{ loan.bank_name }}</p>
                </div>
                <div class="col-md-4">
                    <p><strong>Account Number:</strong> {{ loan.bank_account }}</p>
                </div>
            </div>

            <hr>

            <!-- Dates -->
            <h5 class="mb-3 text-secondary">Dates</h5>
            <div class="row mb-4">
                <div class="col-md-4">
                    <p><strong>Approval Date:</strong> {{ loan.disbursed_at }}</p>
                </div>
                <!-- <div class="col-md-4">
                    <p><strong>Due Date:</strong> {{ loan.due_date }}</p>
                </div> -->
            </div>

            <hr>

            <!-- Action Buttons (Admin Only) -->
            {% if user.is_staff %}
            <div class="mt-3">
                {% if loan.status == "Pending" %}
                    <a href="{% url 'approve_loan' loan.id %}" class="btn btn-success">Approve</a>
                    <a href="{% url 'reject_loan' loan.id %}" class="btn btn-danger">Reject</a>
                {% endif %}

                <a href="{% url 'edit_loan' loan.id %}" class="btn btn-warning">Edit</a>
                <a href="{% url 'delete_loan' loan.id %}" class="btn btn-outline-danger">Delete</a>
            </div>
            {% endif %}

        </div>
    </div>
</div>
{% endblock %}
